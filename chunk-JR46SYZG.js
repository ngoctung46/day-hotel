import{c as j}from"./chunk-HODHY5GA.js";import{a as K}from"./chunk-JWGCYNZ2.js";import{a as B}from"./chunk-FVP4ZNBQ.js";import{a as Y,b as R}from"./chunk-4RXUG7LP.js";import{d as T,g as w,k,m as D,p as X,q as J,r as z,t as P}from"./chunk-QZCFPOZ3.js";import{Ab as y,Bb as c,Cb as h,Db as g,Ga as l,Jb as E,Kb as S,Lb as F,Qa as b,Va as V,ab as _,ca as u,eb as O,gb as x,hb as I,hc as U,ia as C,ib as n,ja as L,jb as i,kb as s,kc as G,lc as H,mc as M,nb as q,pa as W,pb as p,qb as v,yb as d,zb as f}from"./chunk-N2SH4PON.js";function ne(m,t){if(m&1&&(n(0,"option",3),d(1),i()),m&2){let e=t.$implicit;_("ngValue",e),l(),f(e.name)}}var A=class m{added=new W;orderId="";orderLineService=u(B);productService=u(K);orderService=u(R);orderLine={quantity:1};products=[];selectedProduct={};constructor(){this.productService.getItems().then(t=>this.products=t.sort((e,r)=>e.type-r.type).sort((e,r)=>e?.name.toUpperCase()>r?.name.toUpperCase()?1:e?.name.toUpperCase()<r?.name.toUpperCase()?-1:0).filter(e=>e.type!=3))}addOrderLine(){this.orderLine.product=this.selectedProduct,this.orderLine.productId=this.selectedProduct.id,this.orderLine.total=this.orderLine?.product?.price*this.orderLine?.quantity,this.orderLine.orderId=this.orderId,this.orderId!=""&&this.orderLineService.addItem(this.orderLine).then(t=>this.added.emit(!0))}static \u0275fac=function(e){return new(e||m)};static \u0275cmp=b({type:m,selectors:[["orders-order-line"]],inputs:{orderId:"orderId"},outputs:{added:"added"},decls:15,vars:3,consts:[[1,"input-group"],[1,"input-group-text","bg-success","text-light"],["id","product-type","aria-label","product",1,"form-select",3,"ngModelChange","ngModel"],[3,"ngValue"],[1,"input-group-text","bg-success","text-light",2,"margin-left","16px"],["type","number","placeholder","Gi\xE1","aria-label","Gi\xE1",1,"form-control",3,"ngModelChange","ngModel"],["type","number","placeholder","S\u1ED1 l\u01B0\u1EE3ng","aria-label","quantity",1,"form-control","w-10",3,"ngModelChange","ngModel"],[1,"btn-group"],["type","submit",1,"btn","btn-warning",2,"margin-left","16px",3,"click"]],template:function(e,r){e&1&&(n(0,"div",0)(1,"span",1),d(2,"T\xEAn"),i(),n(3,"select",2),g("ngModelChange",function(o){return h(r.selectedProduct,o)||(r.selectedProduct=o),o}),x(4,ne,2,2,"option",3,O),i(),n(6,"span",4),d(7,"Gi\xE1 ti\u1EC1n"),i(),n(8,"input",5),g("ngModelChange",function(o){return h(r.selectedProduct.price,o)||(r.selectedProduct.price=o),o}),i(),n(9,"span",4),d(10,"S\u1ED1 l\u01B0\u1EE3ng"),i(),n(11,"input",6),g("ngModelChange",function(o){return h(r.orderLine.quantity,o)||(r.orderLine.quantity=o),o}),i(),n(12,"div",7)(13,"button",8),p("click",function(){return r.addOrderLine()}),d(14," Th\xEAm "),i()()()),e&2&&(l(3),c("ngModel",r.selectedProduct),l(),I(r.products),l(4),c("ngModel",r.selectedProduct.price),l(3),c("ngModel",r.orderLine.quantity))},dependencies:[P,J,z,T,D,X,w,k,M],encapsulation:2})};function oe(m,t){if(m&1&&(n(0,"h6",18),d(1),E(2,"date"),i()),m&2){let e=v();l(),y(" Gi\u1EDD v\xE0o: ",F(2,1,e.order==null?null:e.order.checkInTime,"dd/MM/yyyy hh:mm:ss"),`
`)}}function de(m,t){if(m&1){let e=q();n(0,"tr")(1,"th",19),d(2),i(),n(3,"td"),d(4),i(),n(5,"td",20),d(6),E(7,"number"),i(),n(8,"td",20)(9,"input",21),g("ngModelChange",function(a){let o=C(e).$implicit;return h(o.quantity,a)||(o.quantity=a),L(a)}),i()(),n(10,"th",20),d(11),E(12,"number"),i(),n(13,"th",22)(14,"div",23)(15,"button",24),p("click",function(){let a=C(e).$implicit,o=v();return L(o.update(a))}),i(),n(16,"button",25),p("click",function(){let a=C(e).$implicit,o=v();return L(o.remove(a))}),i()()()()}if(m&2){let e=t.$implicit,r=t.$index;l(2),f(r+1),l(2),f(e.product==null?null:e.product.name),l(2),f(S(7,5,e.product==null?null:e.product.price)),l(3),c("ngModel",e.quantity),l(2),y(" ",S(12,7,(e.product==null?null:e.product.price)*e.quantity)," ")}}var Q=class m{set id(t){this.orderId=t,this.getOrder()}orderId="";order;orderLineService=u(B);orderService=u(R);roomService=u(Y);orderLines=[];room={};router=u(j);discount=0;extraFee=0;constructor(){this.getOrderLines()}getOrderLines(){this.orderLineService.getItems().then(t=>this.orderLines=t.filter(e=>e.orderId==this.orderId))}getOrder(){this.orderService.getItemById(this.orderId).then(t=>{this.order=t,this.roomService.getItemById(t?.roomId).then(e=>this.room=e??{})})}get total(){let t=0;return this.orderLines.forEach(e=>t+=e.total),t}get remainingFee(){return this.total-this.discount+this.extraFee}get checkOutTime(){return Date.now}goBack(){this.router.navigate(["/home"])}updateRoom(){this.room.status=4,this.room.orderId="",this.room.customerId="",this.roomService.updateItem(this.room).then()}updateOrder(){if(this.order){this.order.checkOutTime=this.checkOutTime();let t=0;this.orderLines.forEach(e=>{t+=e.total}),this.order.total=t,this.order.discount=this.discount,this.order.charges=this.extraFee,this.orderService.updateItem(this.order)}}updateOrderLine(){let t=this.getRate(),e=this.orderLines.find(r=>r.product?.type==3);return e?.product&&(e.product.price=t,e.quantity=0,e.total=t,this.orderLineService.updateItem(e).then(),this.getOrderLines()),e}update(t){t.total=t.quantity*t.product?.price,this.orderLineService.updateItem(t),this.getOrderLines()}remove(t){t.id&&(this.orderLineService.deleteItem(t.id),this.getOrderLines())}checkOut(){this.updateOrderLine(),this.updateOrder(),this.updateRoom(),this.router.navigate(["/home"])}getRate(){var t=this.orderService.getTimeDiff(this.order?.checkInTime);return t.hours<=5&&t.days===0?this.getHourlyRate(t):this.getDailyRate()}getHourlyRate(t){let e=t.hours===0?0:t.hours-1;return t.hours>=4?this.room.rate:(t.minutes>30&&t.hours>0&&e++,this.room.type===0||1?8e4:1e5)}getDailyRate(){let t=new Date(this.order?.checkInTime),e=t.getFullYear(),r=t.getMonth(),a=t.getDate(),o=t.getHours();o>=0&&o<=6&&a--;let Z=new Date(e,r,a,12,0,0).getTime(),N=this.orderService.getTimeDiff(Z),$=this.getHourlyRate(N);return N.days*this.room.rate+$}static \u0275fac=function(e){return new(e||m)};static \u0275cmp=b({type:m,selectors:[["app-orders"]],inputs:{id:"id"},decls:66,vars:14,consts:[[1,"text-center","text-danger"],[3,"added","orderId"],[1,"text-warning","text-center"],["class","text-success text-center",4,"ngIf"],[1,"text-danger","text-center"],[1,"table-responsive","d-flex","justify-content-center","align-middle"],[1,"table","table-striped","table-bordered","w-auto","rounded-2","align-middle"],[1,"table-danger"],["scope","col",1,"text-center"],["scope","col"],["scope","col",1,"text-end"],["colspan","4",1,"text-end","text-danger"],[1,"text-end","text-danger"],[1,"w-20","text-end"],["type","number","placeholder","ph\u1EE5 thu","aria-label","ph\u1EE5 thu",1,"form-control","form-inline","text-end",3,"ngModelChange","ngModel"],["type","number","placeholder","gi\u1EA3m gi\xE1","aria-label","gi\u1EA3m gi\xE1",1,"form-control","form-inline","text-end",3,"ngModelChange","ngModel"],[1,"btn","btn-outline-danger","bi","bi-caret-left",3,"click"],[1,"btn","btn-outline-danger","bi","bi-box-arrow-right",2,"margin-left","8px",3,"click"],[1,"text-success","text-center"],["scope","row",1,"text-center"],[1,"text-end"],["type","number","placeholder","S\u1ED1 l\u01B0\u1EE3ng","aria-label","quantity",1,"form-control",2,"width","50px !important",3,"ngModelChange","ngModel"],[1,"text-center"],[1,"input-group"],[1,"btn","btn-outline-warning","bi","bi-floppy-fill",3,"click"],[1,"btn","btn-danger","bi","bi-trash-fill",3,"click"]],template:function(e,r){e&1&&(n(0,"h3",0),d(1,"Th\xEAm d\u1ECBch v\u1EE5 ph\xF2ng"),i(),s(2,"p"),n(3,"orders-order-line",1),p("added",function(){return r.getOrderLines()}),i(),s(4,"p")(5,"p"),n(6,"h2",2),d(7,"H\xD3A \u0110\u01A0N"),i(),s(8,"p"),V(9,oe,3,4,"h6",3),n(10,"h6",4),d(11),E(12,"date"),i(),n(13,"div",5)(14,"table",6)(15,"thead")(16,"tr",7)(17,"th",8),d(18,"STT"),i(),n(19,"th",9),d(20,"T\xEAn"),i(),n(21,"th",10),d(22,"Gi\xE1"),i(),n(23,"th",10),d(24,"SL"),i(),n(25,"th",10),d(26,"Th\xE0nh ti\u1EC1n"),i(),s(27,"th"),i()(),n(28,"tbody"),x(29,de,17,9,"tr",null,O),n(31,"tr")(32,"th",11),d(33,"T\u1ED5ng"),i(),n(34,"th",12),d(35),E(36,"number"),i(),s(37,"th",13),i(),n(38,"tr")(39,"th",11),d(40,"Ph\u1EE5 thu"),i(),n(41,"th",12)(42,"input",14),g("ngModelChange",function(o){return h(r.extraFee,o)||(r.extraFee=o),o}),i()(),s(43,"td"),i(),n(44,"tr")(45,"th",11),d(46,"Gi\u1EA3m gi\xE1"),i(),n(47,"th",12)(48,"input",15),g("ngModelChange",function(o){return h(r.discount,o)||(r.discount=o),o}),i()(),s(49,"td"),i(),n(50,"tr")(51,"th",11),d(52,"C\xF2n l\u1EA1i"),i(),n(53,"th",12),d(54),E(55,"number"),i(),s(56,"td"),i(),n(57,"tr"),s(58,"td")(59,"td")(60,"td")(61,"td")(62,"td"),n(63,"td")(64,"button",16),p("click",function(){return r.goBack()}),i(),n(65,"button",17),p("click",function(){return r.checkOut()}),i()()()()()()),e&2&&(l(3),_("orderId",r.orderId),l(6),_("ngIf",r.order==null?null:r.order.checkInTime),l(2),y(" Gi\u1EDD ra: ",F(12,7,r.checkOutTime(),"dd/MM/yyyy hh:mm:ss"),`
`),l(18),I(r.orderLines),l(6),f(S(36,10,r.total)),l(7),c("ngModel",r.extraFee),l(6),c("ngModel",r.discount),l(6),y(" ",S(55,12,r.remainingFee)," "))},dependencies:[M,U,H,G,A,P,T,D,w,k],encapsulation:2})};export{Q as OrdersComponent};
